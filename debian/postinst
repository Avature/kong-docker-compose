#!/bin/bash
set -xv   # this line will enable debug

runPostInstChecksums() {
    source /var/lib/dpkg/info/kong-docker-compose.preinst "postinst"
}

compareAndChecksumsAndRestartIfneeded() {
    if cmp --silent -- "$post_inst_checksums" "$pre_inst_checksums"; then
    echo "Previous plugin files are identical to the new ones, avoiding restart"
    else
    echo "Plugins were updated/installed, restarting kong"
    cd /opt/kong
    docker-compose restart kong
    fi
}

runPostInstChecksums

echo "post-install checksums: $post_inst_checksums"
echo "pre-install checksums: $pre_inst_checksums"

compareAndChecksumsAndRestartIfneeded
